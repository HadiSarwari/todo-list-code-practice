<h1 class="page-title" >{{title}}</h1>
<!-- Task list with drag-and-drop support -->

<div class="task-pane">
  <div class="task-scroll">
    <ul class="task-list"  cdkDropList (cdkDropListDropped)="drop($event)" >      
      <!-- Loop through Active (not completed) tasks and render each one using TaskTileComponent -->
        @for (task of tasks; track task.id) {
          @if (!task.checked) {
            <!-- Task tile component per item -->
            <li cdkDrag>
            <app-task-tile 
              [task]="task"
              (toggleChecked)="toggleChecked($event)"
              (openMenu)="showContextMenu($event)">
            </app-task-tile>
            </li>
          }
        }

      <!-- Completed section toggle + count -->
        @if(completedCount>0){
          <li class="completed-toggle" cdkDragDisabled>
          <button type="button"
            class="completed-btn"
            (click)="showCompleted = !showCompleted"
            [attr.aria-expanded]="showCompleted">
            <span class="arrow" aria-hidden="true">{{ showCompleted ? '▾' : '▸' }}</span>
              Completed
            <span class="count">{{ completedCount  }}</span>
          </button>
          </li>
        }

      <!-- Loop through Completed tasks (visible when expanded) and render each one using TaskTileComponent -->
       @if (showCompleted){
          @for (task of tasks; track task.id) {
          @if (task.checked) {
            <li cdkDragDisabled >
            <app-task-tile
              [task]="task"
              (toggleChecked)="toggleChecked($event)"
              (openMenu)="showContextMenu($event)">
            </app-task-tile>
            </li>
          }
        }
       }

      </ul>
  </div>
  <!-- Add row lives outside the scroller so it stays docked -->
  <ul class="task-list">
  <li class="add-tile" [class.typing]="addTypingClass">
    <div class="add-leading">
      <span class="add-plus" aria-hidden="true"></span>
      <input type="checkbox" class="todo-checkbox" tabindex="-1" />
    </div>
    <input
      class="new-task-input"
      type="text"
      placeholder="Add a task"
      #taskInput
      (input)="addTypingClass = taskInput.value.trim().length > 0"
      (keydown.enter)="addTask(taskInput.value.trim()); taskInput.value=''; addTypingClass=false"
    />
  </li>
  </ul>
</div>



<!-- Context Menu -->
@if (contextMenuVisible) {
  <div
    id="context-menu"
    class="context-menu"
    [style.left.px]="menuX"
    [style.top.px]="menuY"
    role="menu"
    (click)="hideContextMenu()"
  >
    <ul>
      <li><span class="icon sun"></span><span>Add to My Day</span><span class="shortcut">Ctrl+T</span></li>
      <li><span class="icon star"></span><span>Mark as important</span></li>
      <li><span class="icon check"></span><span>Mark as completed</span><span class="shortcut">Ctrl+D</span></li>

      <li class="separator" aria-hidden="true"></li>

      <li><span class="icon cal"></span><span>Due today</span></li>
      <li><span class="icon cal"></span><span>Due tomorrow</span></li>
      <li><span class="icon cal"></span><span>Pick a date</span></li>

      <li class="separator" aria-hidden="true"></li>

      <li class="submenu">
        <span class="icon move"></span><span>Move task to…</span><span class="chev">›</span>
      </li>

      <li class="separator" aria-hidden="true"></li>
      @if (contextMenuTask) {
        <li class="delete" (click)="requestDelete(contextMenuTask)">
        <span class="icon trash"></span><span>Delete task</span><span class="shortcut">Delete</span>
      </li>
      }
    </ul>
  </div>
}

@if (confirmVisible) {
  <div class="modal-backdrop" (click)="cancelDelete()" aria-hidden="true"></div>

  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="delTitle">
    <h3 id="delTitle" class="modal-title">Delete task</h3>
    <p class="modal-body">“{{ pendingDeleteTask?.task }}” will be permanently deleted.</p>
    <div class="modal-actions">
      <button class="btn btn-danger" (click)="confirmDelete()" autofocus>Delete</button>
      <button class="btn btn-ghost" (click)="cancelDelete()">Cancel</button>
    </div>
  </div>
}


    






